install.packages("tidyverse")
install.packages("ggrepel")
install.packages("ggimage")
#needed to install `nflfastR`
install.packages("devtools")
devtools::install_github("mrcaseb/nflfastR")
install.packages("devtools")
# install.packages("tidyverse")
# install.packages("ggrepel")
# install.packages("ggimage")
#
# #needed to install `nflfastR`
# install.packages("devtools")
# devtools::install_github("mrcaseb/nflfastR")
library(tidyverse)
library(ggrepel)
library(ggimage)
library(nflfastR)
install.packages("ellipsis")
library(ellipsis)
# install.packages("tidyverse")
# install.packages("ggrepel")
# install.packages("ggimage")
#
# #needed to install `nflfastR`
# install.packages("devtools")
# devtools::install_github("mrcaseb/nflfastR")
library(tidyverse)
library(ggrepel)
library(ggimage)
library(nflfastR)
# install.packages("tidyverse")
# install.packages("ggrepel")
# install.packages("ggimage")
#
# #needed to install `nflfastR`
# install.packages("devtools")
devtools::install_github("mrcaseb/nflfastR")
library(nflfastR)
options(scipen = 9999)
data <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2019.rds'))
head(data)
View(data)
sum(data$td_team)
sum(data$td_team, na.rm = TRUE)
count(data$td_team)
counta(data$td_team)
is.na(data$td_team)
!is.na(data$td_team)
sum(!is.na(data$td_team))
data %>% mutate(td = !is.na(td_team))
sum(data$td)
head(data$td)
data <- data %>% mutate(td = !is.na(td_team))
head(data$td)
sum(data$td)
data %>%
group_by(game_id, drive) %>%
summarize(sum(td))
drive_touchdowns <- data %>%
group_by(game_id, drive) %>%
summarize(sum(td))
View(drive_touchdowns)
complete.cases(drive_touchdowns)
drive_touchdowns[complete.cases(drive_touchdowns)]
drive_touchdowns[complete.cases(drive_touchdowns), ]
drive_touchdowns <- drive_touchdowns[complete.cases(drive_touchdowns), ]
nrow(drive_touchdowns)
nrow(drive_touchdowns) / sum(drive_touchdowns$`sum(td)`)
sum(drive_touchdowns$`sum(td)`) / nrow(drive_touchdowns)
td_percent <- sum(drive_touchdowns$`sum(td)`) / nrow(drive_touchdowns)
library(tidyverse)
library(ggrepel)
library(ggimage)
library(nflfastR)
options(scipen = 9999)
data <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2019.rds'))
head(data)
sum(!is.na(data$td_team))
data <- data %>% mutate(td = !is.na(td_team))
drive_touchdowns <- data %>%
group_by(game_id, drive) %>%
summarize(sum(td))
View(drive_touchdowns)
View(data)
names(data)
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
summarize(sum(td))
data[data$special == 0, ]
data
data$special == 0
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
mutate(starting_position = first(yardline_100)) %>%
summarize(sum(td))
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
summarize(sum(td)) %>%
mutate(starting_position = first(yardline_100))
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
mutate(starting_position = first(yardline_100))
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
mutate(starting_position = first(yardline_100)) %>%
summarize(sum(td))
data <- data %>% mutate(td = !is.na(td_team))
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
mutate(starting_position = first(yardline_100)) %>%
summarize(sum(td))
View(drive_touchdowns)
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
mutate(starting_position = first(yardline_100)) %>%
group_by(game_id, drive) %>%
summarize(sum(td))
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
mutate(starting_position = first(yardline_100)) %>%
group_by(game_id, drive, starting_position) %>%
summarize(sum(td))
drive_touchdowns <- drive_touchdowns[complete.cases(drive_touchdowns), ]
75/10
floor(75/10)
ceiling(75/10)
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
mutate(starting_position = ceiling(first(yardline_100) / 10)) %>%
group_by(game_id, drive, starting_position) %>%
summarize(sum(td))
drive_touchdowns <- drive_touchdowns[complete.cases(drive_touchdowns), ]
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
mutate(starting_position = ceiling(first(yardline_100) / 10)) %>%
group_by(game_id, drive, starting_position) %>%
summarize(touchdown = sum(td))
drive_touchdowns <- drive_touchdowns[complete.cases(drive_touchdowns), ]
drive_touchdowns %>%
group_by(starting_position) %>%
summarize(mean(touchdown))
drive_touchdowns %>%
group_by(starting_position) %>%
summarize(mean(touchdown)) %>%
ggplot(aes(starting_position)) +
geom_col()
drive_touchdowns %>%
group_by(starting_position) %>%
summarize(td_percentage = mean(touchdown)) %>%
ggplot(aes(starting_position, td_percentage)) +
geom_col()
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
mutate(starting_position = as.factor(ceiling(first(yardline_100) / 10))) %>%
group_by(game_id, drive, starting_position) %>%
summarize(touchdown = sum(td))
drive_touchdowns <- drive_touchdowns[complete.cases(drive_touchdowns), ]
td_percent <- sum(drive_touchdowns$`sum(td)`) / nrow(drive_touchdowns)
drive_touchdowns %>%
group_by(starting_position) %>%
summarize(td_percentage = mean(touchdown)) %>%
ggplot(aes(starting_position, td_percentage)) +
geom_col()
?as.factor
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
mutate(starting_position = as.factor(ceiling(first(yardline_100) / 10), levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"))) %>%
group_by(game_id, drive, starting_position) %>%
summarize(touchdown = sum(td))
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
mutate(starting_position = factor(ceiling(first(yardline_100) / 10), levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"))) %>%
group_by(game_id, drive, starting_position) %>%
summarize(touchdown = sum(td))
drive_touchdowns <- drive_touchdowns[complete.cases(drive_touchdowns), ]
td_percent <- sum(drive_touchdowns$`sum(td)`) / nrow(drive_touchdowns)
drive_touchdowns %>%
group_by(starting_position) %>%
summarize(td_percentage = mean(touchdown)) %>%
ggplot(aes(starting_position, td_percentage)) +
geom_col()
names(data)
data[data$fumble == 1, ]
fumble <- data[data$fumble == 1, ]
View(fumble)
?which
which(data$fumble == 1)
fumble <- data[which(data$fumble == 1), ]
fumble <- data[which(data$fumble_lost == 1), ]
fumble <- data[which(data$fumble_forced == 1), ]
fumble <- data[which(data$interception == 1), ]
fumble <- data[which(data$interception == 1) | which(data$fumble_lost == 1), ]
fumble <- data[which(data$interception == 1) || which(data$fumble_lost == 1), ]
fumble <- data[which(data$interception == 1) | which(data$fumble_lost == 1), ]
which(data$fumble_lost == 1)
which(data$interception == 1)
fumble <- data[which(data$interception == 1) || which(data$fumble_lost == 1), ]
fumble <- data[which(data$interception == 1 | data$fumble_lost == 1), ]
data$turnover <- 0
data$turnover
data$turnover[which(data$interception == 1 | data$fumble_lost == 1)]
data$turnover[which(data$interception == 1 | data$fumble_lost == 1)] <- 1
data$turnover
?lag
lag(data$turnover, n = 1)
data$drive_after_turnover <- lag(data$turnover, n = 1)
data$drive_after_turnover
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
mutate(starting_position    = factor(ceiling(first(yardline_100) / 10), levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10")),
drive_after_turnover = first(drive_after_turnover)) %>%
group_by(game_id, drive, starting_position, drive_after_turnover) %>%
summarize(touchdown = sum(td))
drive_touchdowns <- drive_touchdowns[complete.cases(drive_touchdowns), ]
drive_touchdowns %>%
group_by(starting_position) %>%
summarize(td_percentage = mean(touchdown))
drive_touchdowns[which(drive_touchdowns$drive_after_turnover == 1), ]
baseline_drives <- drive_touchdowns %>%
group_by(starting_position) %>%
summarize(td_percentage = mean(touchdown))
after_turnover_drives <- drive_touchdowns[which(drive_touchdowns$drive_after_turnover == 1), ] %>%
group_by(starting_position) %>%
summarize(td_percentage = mean(touchdown))
baseline_drives
after_turnover_drives
ggplot() +
geom_col(baseline_drives, aes(starting_position, td_percentage)) +
geom_col(after_turnover_drives, aes(starting_position, td_percentage))
ggplot() +
geom_col(baseline_drives, aes(starting_position, td_percentage))
ggplot(NULL, aes(x, y)) +
geom_col(baseline_drives, aes(starting_position, td_percentage)) +
geom_col(after_turnover_drives, aes(starting_position, td_percentage))
ggplot(NULL, mapping = aes(x, y)) +
geom_col(baseline_drives, aes(starting_position, td_percentage)) +
geom_col(after_turnover_drives, aes(starting_position, td_percentage))
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage))
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage)) +
geom_col(dadta = after_turnover_drives, aes(starting_position, td_percentage))
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage)) +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage))
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), alpha = 0.5) +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), alpha = 0.5)
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), alpha = 0.5) +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), alpha = 0.5, position = "dodge")
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), alpha = 0.5) +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), alpha = 0.5, position = position_dodge(0.5))
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), alpha = 0.5, width = 0.5
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), alpha = 0.5) +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), alpha = 0.5, width = 0.5)
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), alpha = 0.5) +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), alpha = 0.5)
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), alpha = 0.5)
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), alpha = 0.5) +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), alpha = 0.5, width = 0.5)
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), color = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), color = "#e49444", width = 0.5)
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5)
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5) +
theme_classic()
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5) +
theme_classic() +
labs(x = "Starting 10-yard line", y = "Proportion of drives ending in touchdowns") +
ggtitle("Touchdown drives after turnovers vs baseline") +
coord_fixed(expand = TRUE)
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5) +
theme_classic() +
labs(x = "Starting 10-yard line", y = "Proportion of drives ending in touchdowns") +
ggtitle("Touchdown drives after turnovers vs baseline") +
coord_fixed(expand = FALSE)
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5) +
theme_classic() +
labs(x = "Starting 10-yard line", y = "Proportion of drives ending in touchdowns") +
ggtitle("Touchdown drives after turnovers vs baseline") +
coord_cartesian(expand = FALSE)
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5) +
theme_classic() +
labs(x = "Starting 10-yard line", y = "Proportion of drives ending in touchdowns") +
ggtitle("Touchdown drives after turnovers vs baseline") +
coord_cartesian(expand = FALSE) +
scale_color_manual()
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5) +
theme_classic() +
labs(x = "Starting 10-yard line", y = "Proportion of drives ending in touchdowns") +
ggtitle("Touchdown drives after turnovers vs baseline") +
coord_cartesian(expand = FALSE) +
scale_color_manual(values = colors)
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5) +
theme_classic() +
labs(x = "Starting 10-yard line", y = "Proportion of drives ending in touchdowns") +
ggtitle("Touchdown drives after turnovers vs baseline") +
coord_cartesian(expand = FALSE) +
scale_color_manual(values = c("hi", "yo"))
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5) +
theme_classic() +
labs(x = "Starting 10-yard line", y = "Proportion of drives ending in touchdowns") +
ggtitle("Touchdown drives after turnovers vs baseline") +
coord_cartesian(expand = FALSE) +
scale_color_manual(values = c("hi" = "#5778a4", "yo" = "#e49444"))
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5) +
theme_classic() +
labs(x = "Starting 10-yard line", y = "Proportion of drives ending in touchdowns", color = "Legend") +
ggtitle("Touchdown drives after turnovers vs baseline") +
coord_cartesian(expand = FALSE)
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5) +
theme_classic() +
labs(x = "Starting 10-yard line", y = "Proportion of drives ending in touchdowns", color = "Legend") +
ggtitle("Touchdown drives after turnovers vs baseline") +
coord_cartesian(expand = FALSE) +
scale_color_manual(values = c("hi" = "#5778a4", "yo" = "#e49444"))
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5) +
theme_classic() +
labs(x = "Starting 10-yard line", y = "Proportion of drives ending in touchdowns", color = "Legend") +
ggtitle("Touchdown drives after turnovers vs baseline") +
coord_cartesian(expand = FALSE) +
scale_color_manual(values = c("hi" = "#5778a4", "yo" = "#e49444"), labels = c("hi", "yo"))
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5) +
theme_classic() +
labs(x = "Starting 10-yard line", y = "Proportion of drives ending in touchdowns") +
ggtitle("Touchdown drives after turnovers vs baseline") +
coord_cartesian(expand = FALSE)
td_percent <- sum(drive_touchdowns$`sum(td)`) / nrow(drive_touchdowns)
td_percent
td_percent <- sum(drive_touchdowns$touchdown / nrow(drive_touchdowns)
library(tidyverse)
library(ggrepel)
library(ggimage)
library(nflfastR)
options(scipen = 9999)
data <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2019.rds'))
head(data)
sum(!is.na(data$td_team))
data <- data %>% mutate(td = !is.na(td_team))
data$turnover <- 0
data$turnover[which(data$interception == 1 | data$fumble_lost == 1)] <- 1
data$drive_after_turnover <- lag(data$turnover, n = 1)
drive_touchdowns <- data[data$special == 0, ] %>%
group_by(game_id, drive) %>%
mutate(starting_position    = factor(ceiling(first(yardline_100) / 10), levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10")),
drive_after_turnover = first(drive_after_turnover)) %>%
group_by(game_id, drive, starting_position, drive_after_turnover) %>%
summarize(touchdown = sum(td))
drive_touchdowns <- drive_touchdowns[complete.cases(drive_touchdowns), ]
baseline_drives <- drive_touchdowns %>%
group_by(starting_position) %>%
summarize(td_percentage = mean(touchdown))
after_turnover_drives <- drive_touchdowns[which(drive_touchdowns$drive_after_turnover == 1), ] %>%
group_by(starting_position) %>%
summarize(td_percentage = mean(touchdown))
ggplot(baseline_drives) +
geom_col(aes(starting_position, td_percentage), fill = "#5778a4") +
geom_col(data = after_turnover_drives, aes(starting_position, td_percentage), fill = "#e49444", width = 0.5) +
theme_classic() +
labs(x = "Starting 10-yard line", y = "Proportion of drives ending in touchdowns") +
ggtitle("Touchdown drives after turnovers vs baseline") +
coord_cartesian(expand = FALSE)
